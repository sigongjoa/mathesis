# Use Case 05: ì‹œí—˜ ì¤€ë¹„

> í•™êµ ì‹œí—˜ 2ì£¼ ì „, í•™ìƒì˜ ì•½ì  ë¶„ì„ ê¸°ë°˜ ë³µìŠµ ê³„íš ìë™ ìƒì„± ë° ì˜ˆìƒ ë¬¸ì œ ì œê³µìœ¼ë¡œ íš¨ìœ¨ì ì¸ ì‹œí—˜ ëŒ€ë¹„

**ì‘ì„±ì¼**: 2026-01-10
**ë²„ì „**: 1.0
**ê´€ë ¨ ë…¸ë“œ**: Node 0, Node 1, Node 2, Node 5, Node 7

---

## ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”

### ìƒí™© ì„¤ëª…

ì¤‘í•™êµ 3í•™ë…„ ìµœìˆ˜ì§„ í•™ìƒì€ 2ì£¼ í›„ ì¤‘ê°„ê³ ì‚¬(ìˆ˜í•™ ë²”ìœ„: ì´ì°¨í•¨ìˆ˜, ì´ì°¨ë°©ì •ì‹)ë¥¼ ì•ë‘ê³  ìˆìŠµë‹ˆë‹¤. **Mathesis ì‹œí—˜ ì¤€ë¹„ ëª¨ë“œ**ë¥¼ í™œì„±í™”í•˜ë©´, ë‹¤ìŒê³¼ ê°™ì€ ë§ì¶¤í˜• ì‹œí—˜ ëŒ€ë¹„ í”Œëœì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤:

1. **ì‹œí—˜ ë²”ìœ„ ì„¤ì •**
   - ì„ ìƒë‹˜ì´ ì§€ì •í•œ ì‹œí—˜ ë²”ìœ„: "ì¤‘í•™ìˆ˜í•™.3í•™ë…„.ì´ì°¨í•¨ìˆ˜, ì´ì°¨ë°©ì •ì‹"
   - ì˜ˆìƒ ì‹œí—˜ ë‚ ì§œ: 2026-01-27 (2ì£¼ í›„)

2. **ì•½ì  ìš°ì„  ë³µìŠµ**
   - Node 2 (Q-DNA) BKT ë¶„ì„ ê²°ê³¼:
     - ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹: ìˆ™ë ¨ë„ 0.42 âŒ
     - ì´ì°¨í•¨ìˆ˜ ê·¸ë˜í”„: ìˆ™ë ¨ë„ 0.68 âš ï¸
     - ì´ì°¨í•¨ìˆ˜ ìµœëŒ“ê°’: ìˆ™ë ¨ë„ 0.85 âœ…
   - Node 7 (Error Note) ì˜¤ë‹µ ë¶„ì„:
     - "ê·¼ì˜ ê³µì‹ ë¶€í˜¸ ì‹¤ìˆ˜" ì˜¤ë‹µë…¸íŠ¸ 3ê±´ â†’ ë³µìŠµ ìš°ì„ ìˆœìœ„ 1ìœ„

3. **2ì£¼ ë³µìŠµ ê³„íš ìë™ ìƒì„±**
   ```
   Week 1 (1/13-1/19):
   - Day 1-3: ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹ ì§‘ì¤‘ ë³µìŠµ (ì˜¤ë‹µë…¸íŠ¸ 3ê±´ + ë¬¸ì œ 15ê°œ)
   - Day 4-5: ì´ì°¨í•¨ìˆ˜ ê·¸ë˜í”„ ë³µìŠµ (ë¬¸ì œ 10ê°œ)
   - Day 6-7: í†µí•© ë¬¸ì œ (ë¬¸ì œ 20ê°œ)

   Week 2 (1/20-1/26):
   - Day 8-10: ì˜ˆìƒ ë¬¸ì œ í’€ì´ (AI ìƒì„± 30ë¬¸ì œ)
   - Day 11-12: ëª¨ì˜ê³ ì‚¬ 2íšŒ (ê° 20ë¬¸ì œ)
   - Day 13-14: ì˜¤ë‹µ ì¬ë³µìŠµ + ìµœì¢… ì ê²€
   ```

4. **AI ì˜ˆìƒ ë¬¸ì œ ìƒì„±**
   - Node 2 (Q-DNA) + mathesis_core.generationìœ¼ë¡œ ì‹œí—˜ ë²”ìœ„ ë‚´ ë¬¸ì œ ìë™ ìƒì„±
   - í•™êµ ê¸°ì¶œ íŒ¨í„´ ë¶„ì„ (Node 6: School Info)
   - ë‚œì´ë„ ë¶„í¬: ì‰¬ì›€(30%), ë³´í†µ(50%), ì–´ë ¤ì›€(20%)

5. **ëª¨ì˜ê³ ì‚¬ ìƒì„±**
   - Node 5 (Report Node)ê°€ Typstë¡œ ì‹¤ì œ ì‹œí—˜ì§€ í˜•ì‹ PDF ìƒì„±
   - ì‹œê°„ ì œí•œ: 50ë¶„ (ì‹¤ì „ ì—°ìŠµ)
   - ìë™ ì±„ì  + ì·¨ì•½ì  ë¶„ì„ ë¦¬í¬íŠ¸

### ì‚¬ìš©ì

- **ì£¼ ì‚¬ìš©ì**: í•™ìƒ (ì‹œí—˜ ì¤€ë¹„)
- **ë³´ì¡° ì‚¬ìš©ì**: êµì‚¬ (ì‹œí—˜ ë²”ìœ„ ì„¤ì •, í´ë˜ìŠ¤ ì „ì²´ ì¤€ë¹„ í˜„í™©), í•™ë¶€ëª¨ (ì§„í–‰ ëª¨ë‹ˆí„°ë§)

### ëª©í‘œ

1. **íš¨ìœ¨ì  ì‹œí—˜ ëŒ€ë¹„**: ì•½ì  ìš°ì„  ë³µìŠµìœ¼ë¡œ ì‹œê°„ ì ˆì•½
2. **ê³¼í•™ì  ë³µìŠµ ìŠ¤ì¼€ì¤„**: Anki + BKT ê¸°ë°˜ ìµœì  ë³µìŠµ ì‹œì  ê³„ì‚°
3. **ì‹¤ì „ ì—°ìŠµ**: ëª¨ì˜ê³ ì‚¬ë¡œ ì‹œê°„ ê´€ë¦¬ ë° ì‹¤ì „ ê°ê° í–¥ìƒ
4. **ë¶ˆì•ˆê° í•´ì†Œ**: ëª…í™•í•œ ê³„íš ì œê³µ â†’ ì‹¬ë¦¬ì  ì•ˆì •ê°

---

## ğŸ¯ ê´€ë ¨ ë…¸ë“œ

| Node | ì—­í•  | ì£¼ìš” ì‘ì—… |
|------|------|----------|
| **Node 0 (Student Hub)** | ì‹œí—˜ ì¤€ë¹„ ì›Œí¬í”Œë¡œìš° ì¡°ì • | ë³µìŠµ ê³„íš ìƒì„±, ì§„í–‰ ê´€ë¦¬, ëª¨ë“  ë…¸ë“œ í†µí•© |
| **Node 1 (Logic Engine)** | ì‹œí—˜ ë²”ìœ„ ê°œë… íŠ¸ë¦¬ ì¡°íšŒ | ì‹œí—˜ ë²”ìœ„ì˜ ì„ ìˆ˜ ì§€ì‹ í™•ì¸, ê°œë… ê´€ê³„ |
| **Node 2 (Q-DNA)** | ì•½ì  ë¶„ì„ & ë¬¸ì œ ì¶”ì²œ | BKT ìˆ™ë ¨ë„ ì¡°íšŒ, ì˜ˆìƒ ë¬¸ì œ ìƒì„±, Twin ë¬¸ì œ |
| **Node 5 (Report Node)** | ëª¨ì˜ê³ ì‚¬ PDF ìƒì„± | Typstë¡œ ì‹œí—˜ì§€ í˜•ì‹ PDF, ì±„ì  ë¦¬í¬íŠ¸ |
| **Node 7 (Error Note)** | ì˜¤ë‹µ ìš°ì„  ë³µìŠµ | ì‹œí—˜ ë²”ìœ„ ë‚´ ì˜¤ë‹µë…¸íŠ¸ ì¡°íšŒ, ë³µìŠµ ìŠ¤ì¼€ì¤„ |

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant S as Student App
    participant N0 as Node 0<br/>(Orchestrator)
    participant N1 as Node 1<br/>(Logic Engine)
    participant N2 as Node 2<br/>(Q-DNA)
    participant N5 as Node 5<br/>(Report)
    participant N7 as Node 7<br/>(Error Note)

    Note over S,N7: Phase 1: ì‹œí—˜ ë²”ìœ„ ì„¤ì • ë° ë¶„ì„

    S->>N0: POST /workflows/exam-preparation<br/>{student_id, exam_scope: ["ì´ì°¨í•¨ìˆ˜", "ì´ì°¨ë°©ì •ì‹"],<br/>exam_date: "2026-01-27"}

    activate N0
    N0->>N1: MCP call: get_concept_tree<br/>{concepts: ["ì´ì°¨í•¨ìˆ˜", "ì´ì°¨ë°©ì •ì‹"]}
    activate N1
    N1->>N1: Neo4j ì¿¼ë¦¬: ê°œë… ê³„ì¸µ êµ¬ì¡°
    N1-->>N0: {concepts: [...], prerequisites: [...]}
    deactivate N1

    N0->>N2: MCP call: get_student_mastery<br/>{student_id, skill_ids: [...]}
    activate N2
    N2-->>N0: {<br/>  "ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹": 0.42,<br/>  "ì´ì°¨í•¨ìˆ˜ ê·¸ë˜í”„": 0.68,<br/>  "ì´ì°¨í•¨ìˆ˜ ìµœëŒ“ê°’": 0.85<br/>}
    deactivate N2

    N0->>N7: MCP call: get_error_notes<br/>{student_id, concepts: [...]}
    activate N7
    N7-->>N0: [<br/>  {concept: "ê·¼ì˜ ê³µì‹", error_count: 3, priority: 1},<br/>  {concept: "ê·¸ë˜í”„", error_count: 1, priority: 2}<br/>]
    deactivate N7

    Note over N0: ì•½ì  ë¶„ì„:<br/>1. ì˜¤ë‹µ ë§ì€ ê°œë…<br/>2. BKT ë‚®ì€ ê°œë…<br/>3. ì„ ìˆ˜ ì§€ì‹ ë¶€ì¡±

    Note over S,N7: Phase 2: 2ì£¼ ë³µìŠµ ê³„íš ìƒì„±

    N0->>N0: generate_study_plan()<br/>- Week 1: ì•½ì  ë³µìŠµ<br/>- Week 2: ì˜ˆìƒ ë¬¸ì œ + ëª¨ì˜ê³ ì‚¬

    loop ê° ë‹¨ê³„ë§ˆë‹¤
        N0->>N2: MCP call: recommend_questions<br/>{concept, difficulty, count}
        activate N2
        N2-->>N0: [Q1, Q2, ..., Q15]
        deactivate N2
    end

    N0->>N7: MCP call: schedule_error_reviews<br/>{error_note_ids, days_before_exam: 14}
    activate N7
    N7->>N7: Anki ìŠ¤ì¼€ì¤„ ì¡°ì •:<br/>ì‹œí—˜ ì „ê¹Œì§€ ëª¨ë“  ì˜¤ë‹µ ìµœì†Œ 2íšŒ ë³µìŠµ
    N7-->>N0: {review_schedule: [...]}
    deactivate N7

    N0-->>S: {<br/>  plan_id: "exam_plan_789",<br/>  exam_date: "2026-01-27",<br/>  days_until_exam: 14,<br/>  week1_plan: [...],<br/>  week2_plan: [...],<br/>  total_problems: 95<br/>}
    deactivate N0

    Note over S,N7: Phase 3: ì˜ˆìƒ ë¬¸ì œ ìƒì„± (Week 2)

    S->>N0: POST /workflows/generate-practice-exam<br/>{plan_id, type: "predicted_problems"}
    activate N0

    N0->>N2: MCP call: generate_exam_questions<br/>{concepts, difficulty_dist: [0.3, 0.5, 0.2],<br/>count: 30}
    activate N2
    N2->>N2: mathesis_core.generation<br/>ProblemGenerator.create_exam_set()
    N2-->>N0: [Q1, Q2, ..., Q30]
    deactivate N2

    N0-->>S: {practice_exam_id: "pe_123", questions: [...]}
    deactivate N0

    Note over S,N7: Phase 4: ëª¨ì˜ê³ ì‚¬ ìƒì„± ë° ì±„ì 

    S->>N0: POST /workflows/generate-mock-exam<br/>{plan_id, difficulty: "actual"}
    activate N0

    N0->>N2: MCP call: recommend_questions<br/>{exam_scope, count: 20, difficulty: "mixed"}
    activate N2
    N2-->>N0: [Q1, Q2, ..., Q20]
    deactivate N2

    N0->>N5: MCP call: generate_exam_pdf<br/>{questions, format: "school_exam", time_limit: 50}
    activate N5
    N5->>N5: Typst í…œí”Œë¦¿ ë Œë”ë§<br/>(ì‹œí—˜ì§€ + OMR ë‹µì•ˆì§€)
    N5-->>N0: {pdf_url: "s3://exams/mock_123.pdf"}
    deactivate N5

    N0-->>S: {mock_exam_id: "me_456", pdf_url: "..."}
    deactivate N0

    Note over S: í•™ìƒì´ ëª¨ì˜ê³ ì‚¬ í’€ì´ (50ë¶„)

    S->>N0: POST /mock-exams/me_456/submit<br/>{answers: [...]}
    activate N0
    N0->>N0: ìë™ ì±„ì  + ì·¨ì•½ì  ë¶„ì„

    N0->>N5: MCP call: generate_typst_report<br/>{type: "mock_exam_result"}
    activate N5
    N5-->>N0: {result_pdf_url: "..."}
    deactivate N5

    N0-->>S: {<br/>  score: 85,<br/>  accuracy: 0.85,<br/>  weak_areas: ["ê·¼ì˜ ê³µì‹"],<br/>  result_pdf_url: "..."<br/>}
    deactivate N0
```

---

## ğŸ”„ ìƒì„¸ í”Œë¡œìš°

### Step 1: ì‹œí—˜ ì¤€ë¹„ ëª¨ë“œ í™œì„±í™” ë° ê³„íš ìƒì„±

**API**: `POST /api/v1/workflows/exam-preparation`

**Request**:
```json
{
  "student_id": "student_123",
  "exam_scope": ["ì´ì°¨í•¨ìˆ˜", "ì´ì°¨ë°©ì •ì‹"],
  "exam_date": "2026-01-27",
  "daily_study_minutes": 60,
  "include_school_patterns": true
}
```

**Response**:
```json
{
  "plan_id": "exam_plan_789",
  "exam_date": "2026-01-27",
  "days_until_exam": 14,
  "weak_concepts": [
    {
      "concept": "ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹",
      "current_mastery": 0.42,
      "target_mastery": 0.8,
      "error_count": 3,
      "priority": 1
    },
    {
      "concept": "ì´ì°¨í•¨ìˆ˜ ê·¸ë˜í”„",
      "current_mastery": 0.68,
      "target_mastery": 0.85,
      "error_count": 1,
      "priority": 2
    }
  ],
  "study_plan": {
    "week1": {
      "focus": "ì•½ì  ë³µìŠµ",
      "days": [
        {
          "day": 1,
          "date": "2026-01-13",
          "tasks": [
            {
              "type": "error_review",
              "concept": "ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹",
              "error_notes": ["en_1", "en_2", "en_3"],
              "estimated_minutes": 30
            },
            {
              "type": "problem_solving",
              "concept": "ì´ì°¨ë°©ì •ì‹ ê·¼ì˜ ê³µì‹",
              "question_count": 5,
              "estimated_minutes": 30
            }
          ]
        }
        // ... Day 2-7
      ]
    },
    "week2": {
      "focus": "ì˜ˆìƒ ë¬¸ì œ + ëª¨ì˜ê³ ì‚¬",
      "days": [
        {
          "day": 8,
          "date": "2026-01-20",
          "tasks": [
            {
              "type": "predicted_problems",
              "question_count": 15,
              "estimated_minutes": 60
            }
          ]
        },
        {
          "day": 11,
          "date": "2026-01-23",
          "tasks": [
            {
              "type": "mock_exam",
              "question_count": 20,
              "time_limit_minutes": 50
            }
          ]
        }
        // ... Day 9-14
      ]
    }
  },
  "total_problems": 95,
  "estimated_study_hours": 14,
  "created_at": "2026-01-13T09:00:00Z"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** (Node 0 ë‚´ë¶€):
```python
from datetime import datetime, timedelta
from typing import List, Dict

async def create_exam_preparation_plan(
    student_id: str,
    exam_scope: List[str],
    exam_date: str,
    daily_study_minutes: int = 60
) -> Dict:
    mcp = MCPClientManager()

    exam_date_dt = datetime.fromisoformat(exam_date)
    days_until_exam = (exam_date_dt - datetime.now()).days

    if days_until_exam < 1:
        raise ValueError("ì‹œí—˜ ë‚ ì§œê°€ ì´ë¯¸ ì§€ë‚¬ìŠµë‹ˆë‹¤.")

    # 1. ì‹œí—˜ ë²”ìœ„ ê°œë… íŠ¸ë¦¬ ì¡°íšŒ (Node 1)
    concept_tree = await mcp.call("logic-engine", "get_concept_tree", {
        "concepts": exam_scope
    })

    all_concepts = [c["name"] for c in concept_tree["concepts"]]

    # 2. BKT ìˆ™ë ¨ë„ ì¡°íšŒ (Node 2)
    mastery = await mcp.call("q-dna", "get_student_mastery", {
        "student_id": student_id,
        "skill_ids": all_concepts
    })

    # 3. ì˜¤ë‹µë…¸íŠ¸ ì¡°íšŒ (Node 7)
    error_notes = await mcp.call("error-note", "get_error_notes", {
        "student_id": student_id,
        "concepts": all_concepts
    })

    # 4. ì•½ì  ë¶„ì„ (ìš°ì„ ìˆœìœ„ ê³„ì‚°)
    weak_concepts = analyze_weak_concepts(
        mastery=mastery,
        error_notes=error_notes
    )

    # 5. 2ì£¼ ë³µìŠµ ê³„íš ìƒì„±
    study_plan = generate_exam_study_plan(
        weak_concepts=weak_concepts,
        days_until_exam=days_until_exam,
        daily_study_minutes=daily_study_minutes
    )

    # 6. ì˜¤ë‹µë…¸íŠ¸ ë³µìŠµ ìŠ¤ì¼€ì¤„ ì¡°ì • (Node 7)
    await mcp.call("error-note", "schedule_error_reviews", {
        "student_id": student_id,
        "error_note_ids": [en["id"] for en in error_notes],
        "days_before_exam": days_until_exam,
        "target_review_count": 2  # ì‹œí—˜ ì „ê¹Œì§€ ìµœì†Œ 2íšŒ ë³µìŠµ
    })

    # 7. DB ì €ì¥
    exam_plan = ExamPreparationPlan(
        student_id=student_id,
        exam_scope=exam_scope,
        exam_date=exam_date_dt,
        weak_concepts=weak_concepts,
        study_plan=study_plan
    )
    db.add(exam_plan)
    db.commit()

    return exam_plan


def analyze_weak_concepts(
    mastery: Dict[str, float],
    error_notes: List[Dict]
) -> List[Dict]:
    """
    ì•½ì  ê°œë… ë¶„ì„ ë° ìš°ì„ ìˆœìœ„ ê³„ì‚°

    ìš°ì„ ìˆœìœ„ ì ìˆ˜ = (1 - ìˆ™ë ¨ë„) * 0.6 + (ì˜¤ë‹µ ê°œìˆ˜ / 10) * 0.4
    """
    error_count_by_concept = {}
    for note in error_notes:
        concept = note["concept"]
        error_count_by_concept[concept] = error_count_by_concept.get(concept, 0) + 1

    weak_concepts = []

    for concept, mastery_score in mastery.items():
        if mastery_score < 0.7:  # ìˆ™ë ¨ë„ 70% ë¯¸ë§Œë§Œ ë³µìŠµ ëŒ€ìƒ
            error_count = error_count_by_concept.get(concept, 0)

            # ìš°ì„ ìˆœìœ„ ì ìˆ˜ ê³„ì‚°
            priority_score = (1 - mastery_score) * 0.6 + min(error_count / 10, 1.0) * 0.4

            weak_concepts.append({
                "concept": concept,
                "current_mastery": mastery_score,
                "target_mastery": min(0.85, mastery_score + 0.3),
                "error_count": error_count,
                "priority_score": priority_score
            })

    # ìš°ì„ ìˆœìœ„ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    weak_concepts.sort(key=lambda x: x["priority_score"], reverse=True)

    # ìš°ì„ ìˆœìœ„ ë²ˆí˜¸ ë¶€ì—¬
    for i, concept in enumerate(weak_concepts):
        concept["priority"] = i + 1

    return weak_concepts


def generate_exam_study_plan(
    weak_concepts: List[Dict],
    days_until_exam: int,
    daily_study_minutes: int
) -> Dict:
    """
    2ì£¼ ë³µìŠµ ê³„íš ìƒì„±

    Week 1 (70%): ì•½ì  ì§‘ì¤‘ ë³µìŠµ
    Week 2 (30%): ì˜ˆìƒ ë¬¸ì œ + ëª¨ì˜ê³ ì‚¬
    """
    week1_days = min(7, days_until_exam // 2)
    week2_days = days_until_exam - week1_days

    # Week 1: ì•½ì  ë³µìŠµ
    week1_plan = []
    for day in range(1, week1_days + 1):
        # ìš°ì„ ìˆœìœ„ ë†’ì€ ê°œë…ë¶€í„° ìˆœí™˜ ë°°ì •
        concept_index = (day - 1) % len(weak_concepts)
        concept = weak_concepts[concept_index]

        tasks = [
            {
                "type": "error_review",
                "concept": concept["concept"],
                "estimated_minutes": daily_study_minutes // 2
            },
            {
                "type": "problem_solving",
                "concept": concept["concept"],
                "question_count": 5,
                "estimated_minutes": daily_study_minutes // 2
            }
        ]

        week1_plan.append({
            "day": day,
            "date": (datetime.now() + timedelta(days=day - 1)).date().isoformat(),
            "tasks": tasks
        })

    # Week 2: ì˜ˆìƒ ë¬¸ì œ + ëª¨ì˜ê³ ì‚¬
    week2_plan = []
    mock_exam_days = [week1_days + 4, week1_days + 6]  # Day 11, 13ì— ëª¨ì˜ê³ ì‚¬

    for day in range(week1_days + 1, days_until_exam + 1):
        if day in mock_exam_days:
            tasks = [{
                "type": "mock_exam",
                "question_count": 20,
                "time_limit_minutes": 50
            }]
        else:
            tasks = [{
                "type": "predicted_problems",
                "question_count": 15,
                "estimated_minutes": daily_study_minutes
            }]

        week2_plan.append({
            "day": day,
            "date": (datetime.now() + timedelta(days=day - 1)).date().isoformat(),
            "tasks": tasks
        })

    return {
        "week1": {
            "focus": "ì•½ì  ë³µìŠµ",
            "days": week1_plan
        },
        "week2": {
            "focus": "ì˜ˆìƒ ë¬¸ì œ + ëª¨ì˜ê³ ì‚¬",
            "days": week2_plan
        }
    }
```

---

### Step 2: AI ì˜ˆìƒ ë¬¸ì œ ìƒì„±

**API**: `POST /api/v1/workflows/generate-practice-exam`

**Request**:
```json
{
  "plan_id": "exam_plan_789",
  "type": "predicted_problems",
  "count": 30,
  "difficulty_distribution": {
    "easy": 0.3,
    "medium": 0.5,
    "hard": 0.2
  }
}
```

**Response**:
```json
{
  "practice_exam_id": "pe_123",
  "questions": [
    {
      "question_id": "q_gen_001",
      "content": "ì´ì°¨ë°©ì •ì‹ x^2 - 6x + 8 = 0ì˜ ë‘ ê·¼ì„ êµ¬í•˜ì‹œì˜¤.",
      "difficulty": 0.3,
      "difficulty_label": "easy",
      "concept_tags": ["ì´ì°¨ë°©ì •ì‹", "ê·¼ì˜ ê³µì‹"],
      "generated_by": "mathesis_core.generation",
      "answer": "x = 2 ë˜ëŠ” x = 4"
    }
    // ... 29ê°œ ë”
  ],
  "generated_at": "2026-01-20T10:00:00Z"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** (Node 2 - mathesis_core í™œìš©):
```python
from mathesis_core.generation import ProblemGenerator

async def generate_exam_questions(
    concepts: List[str],
    count: int,
    difficulty_dist: Dict[str, float]
) -> List[Dict]:
    generator = ProblemGenerator()

    # ë‚œì´ë„ë³„ ë¬¸ì œ ìˆ˜ ê³„ì‚°
    easy_count = int(count * difficulty_dist["easy"])
    medium_count = int(count * difficulty_dist["medium"])
    hard_count = count - easy_count - medium_count

    questions = []

    # 1. ì‰¬ìš´ ë¬¸ì œ ìƒì„±
    for _ in range(easy_count):
        q = await generator.create_exam_question(
            concepts=concepts,
            difficulty=0.3,
            question_type="basic"
        )
        questions.append(q)

    # 2. ë³´í†µ ë¬¸ì œ ìƒì„±
    for _ in range(medium_count):
        q = await generator.create_exam_question(
            concepts=concepts,
            difficulty=0.5,
            question_type="application"
        )
        questions.append(q)

    # 3. ì–´ë ¤ìš´ ë¬¸ì œ ìƒì„±
    for _ in range(hard_count):
        q = await generator.create_exam_question(
            concepts=concepts,
            difficulty=0.8,
            question_type="complex"
        )
        questions.append(q)

    # ì„ê¸° (ë‚œì´ë„ ìˆœì„œ ë¬´ì‘ìœ„)
    import random
    random.shuffle(questions)

    return questions
```

---

### Step 3: ëª¨ì˜ê³ ì‚¬ ìƒì„± ë° ì±„ì 

**API**: `POST /api/v1/workflows/generate-mock-exam`

**Request**:
```json
{
  "plan_id": "exam_plan_789",
  "difficulty": "actual",
  "time_limit_minutes": 50,
  "question_count": 20
}
```

**Response**:
```json
{
  "mock_exam_id": "me_456",
  "exam_pdf_url": "https://s3.mathesis.ai/exams/mock_456.pdf",
  "answer_sheet_url": "https://s3.mathesis.ai/exams/mock_456_answers.pdf",
  "questions": [
    {
      "number": 1,
      "question_id": "q_001",
      "content": "...",
      "points": 5
    }
    // ... 19ê°œ ë”
  ],
  "total_points": 100,
  "time_limit_minutes": 50,
  "generated_at": "2026-01-23T09:00:00Z"
}
```

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§** (Node 5 - Typst ì‹œí—˜ì§€ ìƒì„±):
```python
import subprocess
from pathlib import Path

async def generate_mock_exam_pdf(
    questions: List[Dict],
    time_limit: int = 50
) -> Dict:
    # 1. Typst ì‹œí—˜ì§€ í…œí”Œë¦¿
    typst_content = f"""
#set page(paper: "a4", margin: 2cm)
#set text(font: "Noto Sans KR", size: 11pt)

#align(center)[
  #text(size: 20pt, weight: "bold")[ìˆ˜í•™ ëª¨ì˜ê³ ì‚¬]
  #v(0.5cm)
  #text(size: 14pt)[ì œí•œ ì‹œê°„: {time_limit}ë¶„ / ì´ì : 100ì ]
  #v(0.3cm)
  í•™ë…„/ë°˜: __________ ë²ˆí˜¸: ______ ì´ë¦„: __________
]

#v(1cm)

#set enum(numbering: "1.")
#for (i, q) in enumerate({questions}):
  #text(weight: "bold")[#(i+1). (#q["points"]ì )]
  #v(0.2cm)
  #q["content"]
  #v(1.5cm)
"""

    # 2. Typst â†’ PDF ì»´íŒŒì¼
    typst_file = f"/tmp/mock_exam_{datetime.now().strftime('%Y%m%d%H%M%S')}.typ"
    Path(typst_file).write_text(typst_content)

    pdf_file = typst_file.replace(".typ", ".pdf")
    subprocess.run([
        "typst", "compile",
        typst_file,
        pdf_file
    ], check=True)

    # 3. ë‹µì•ˆì§€ ìƒì„± (OMR í˜•ì‹)
    answer_sheet_content = """
#set page(paper: "a4")
#grid(
  columns: (1fr, 1fr, 1fr, 1fr, 1fr),
  rows: auto,
  gutter: 3pt,
  ..range(1, 21).map(i => [
    #text(weight: "bold")[#i.]
    â‘  â‘¡ â‘¢ â‘£ â‘¤
  ])
)
"""
    answer_sheet_file = pdf_file.replace(".pdf", "_answers.pdf")
    Path(answer_sheet_file.replace(".pdf", ".typ")).write_text(answer_sheet_content)
    subprocess.run([
        "typst", "compile",
        answer_sheet_file.replace(".pdf", ".typ"),
        answer_sheet_file
    ], check=True)

    # 4. S3 ì—…ë¡œë“œ
    exam_url = await upload_to_s3(pdf_file, "mathesis-exams")
    answer_url = await upload_to_s3(answer_sheet_file, "mathesis-exams")

    return {
        "exam_pdf_url": exam_url,
        "answer_sheet_url": answer_url
    }
```

---

## ğŸ’» ì½”ë“œ ì˜ˆì‹œ

### Frontend - ì‹œí—˜ ì¤€ë¹„ ëŒ€ì‹œë³´ë“œ

```tsx
import React, { useState, useEffect } from 'react';
import { useParams } from 'react-router-dom';
import { api } from '@/lib/api';

interface ExamPlan {
  plan_id: string;
  exam_date: string;
  days_until_exam: number;
  weak_concepts: any[];
  study_plan: {
    week1: any;
    week2: any;
  };
}

export const ExamPreparationDashboard: React.FC = () => {
  const { planId } = useParams();
  const [plan, setPlan] = useState<ExamPlan | null>(null);
  const [currentDay, setCurrentDay] = useState(1);

  useEffect(() => {
    const fetchPlan = async () => {
      const response = await api.get(`/exam-plans/${planId}`);
      setPlan(response.data);

      // í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ Day ê³„ì‚°
      const startDate = new Date(response.data.created_at);
      const today = new Date();
      const daysSinceStart = Math.floor(
        (today.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)
      );
      setCurrentDay(daysSinceStart + 1);
    };

    fetchPlan();
  }, [planId]);

  if (!plan) return <div>ë¡œë”© ì¤‘...</div>;

  const allDays = [
    ...plan.study_plan.week1.days,
    ...plan.study_plan.week2.days
  ];

  const todayPlan = allDays.find(d => d.day === currentDay);

  return (
    <div className="container mx-auto p-8">
      {/* í—¤ë” */}
      <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg shadow p-6 mb-6">
        <h2 className="text-3xl font-bold mb-2">ì‹œí—˜ ì¤€ë¹„ ëª¨ë“œ</h2>
        <div className="flex gap-6 text-lg">
          <span>D-{plan.days_until_exam}</span>
          <span>ì‹œí—˜ì¼: {new Date(plan.exam_date).toLocaleDateString()}</span>
          <span>ì§„í–‰ë¥ : {Math.round((currentDay / allDays.length) * 100)}%</span>
        </div>
      </div>

      {/* ì•½ì  ê°œë… */}
      <div className="bg-white rounded shadow p-6 mb-6">
        <h3 className="text-xl font-bold mb-4">ì•½ì  ê°œë… (ìš°ì„ ìˆœìœ„)</h3>
        <div className="space-y-2">
          {plan.weak_concepts.map((concept: any) => (
            <div key={concept.concept} className="flex items-center gap-4">
              <span className="badge badge-error">{concept.priority}</span>
              <span className="font-medium flex-1">{concept.concept}</span>
              <div className="flex items-center gap-2">
                <span className="text-sm text-gray-600">
                  ìˆ™ë ¨ë„: {(concept.current_mastery * 100).toFixed(0)}%
                </span>
                <progress
                  className="progress progress-error w-32"
                  value={concept.current_mastery}
                  max={1}
                />
              </div>
              <span className="text-sm text-red-600">
                ì˜¤ë‹µ {concept.error_count}ê±´
              </span>
            </div>
          ))}
        </div>
      </div>

      {/* ì˜¤ëŠ˜ì˜ ê³„íš */}
      {todayPlan && (
        <div className="bg-blue-50 rounded-lg shadow p-6 mb-6">
          <h3 className="text-xl font-bold mb-4">
            ì˜¤ëŠ˜ì˜ ê³„íš (Day {currentDay})
          </h3>
          <div className="space-y-4">
            {todayPlan.tasks.map((task: any, index: number) => (
              <div key={index} className="bg-white rounded p-4">
                <div className="flex justify-between items-center mb-2">
                  <h4 className="font-bold">
                    {task.type === 'error_review' && 'ğŸ“ ì˜¤ë‹µ ë³µìŠµ'}
                    {task.type === 'problem_solving' && 'âœï¸ ë¬¸ì œ í’€ì´'}
                    {task.type === 'predicted_problems' && 'ğŸ¯ ì˜ˆìƒ ë¬¸ì œ'}
                    {task.type === 'mock_exam' && 'ğŸ“„ ëª¨ì˜ê³ ì‚¬'}
                  </h4>
                  <span className="text-sm text-gray-600">
                    {task.estimated_minutes || task.time_limit_minutes}ë¶„
                  </span>
                </div>
                {task.concept && (
                  <p className="text-sm text-gray-600 mb-2">
                    ê°œë…: {task.concept}
                  </p>
                )}
                <button
                  className="btn btn-primary btn-sm"
                  onClick={() => {
                    if (task.type === 'mock_exam') {
                      window.location.href = `/exam-plans/${planId}/mock-exam`;
                    } else {
                      window.location.href = `/exam-plans/${planId}/day/${currentDay}`;
                    }
                  }}
                >
                  ì‹œì‘í•˜ê¸°
                </button>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ì „ì²´ ì¼ì • íƒ€ì„ë¼ì¸ */}
      <div className="bg-white rounded shadow p-6">
        <h3 className="text-xl font-bold mb-4">ì „ì²´ ì¼ì •</h3>
        <div className="timeline timeline-vertical">
          {allDays.map((day: any) => (
            <div
              key={day.day}
              className={`timeline-item ${
                day.day === currentDay ? 'timeline-item-primary' : ''
              } ${day.day < currentDay ? 'timeline-item-success' : ''}`}
            >
              <div className="timeline-start">Day {day.day}</div>
              <div className="timeline-middle">
                {day.day < currentDay ? 'âœ…' : day.day === currentDay ? 'ğŸ”µ' : 'â³'}
              </div>
              <div className="timeline-end">
                <div className="text-sm text-gray-600">{day.date}</div>
                <div className="text-xs">
                  {day.tasks.map((t: any) => t.type).join(', ')}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};
```

---

## ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼

### êµìœ¡ì  íš¨ê³¼

1. **íš¨ìœ¨ì  ì‹œí—˜ ëŒ€ë¹„**
   - ì•½ì  ìš°ì„  ë³µìŠµ â†’ í•™ìŠµ ì‹œê°„ ìµœì í™”
   - ê³¼í•™ì  ë³µìŠµ ìŠ¤ì¼€ì¤„ (Anki + BKT) â†’ ê¸°ì–µ ê°•í™”

2. **ì‹¤ì „ ê°ê° í–¥ìƒ**
   - ëª¨ì˜ê³ ì‚¬ë¡œ ì‹œê°„ ê´€ë¦¬ ì—°ìŠµ
   - ì‹¤ì œ ì‹œí—˜ì§€ í˜•ì‹ PDF â†’ ì‹œí—˜ ì¹œìˆ™ë„ ì¦ê°€

3. **ë¶ˆì•ˆê° í•´ì†Œ**
   - ëª…í™•í•œ 2ì£¼ ê³„íš â†’ ì‹¬ë¦¬ì  ì•ˆì •ê°
   - ì§„í–‰ë¥  ì‹œê°í™” â†’ ì„±ì·¨ê° ë° ë™ê¸° ë¶€ì—¬

4. **ìê¸° ì£¼ë„ í•™ìŠµ**
   - "ë¬´ì—‡ì„ ê³µë¶€í• ì§€" ê³ ë¯¼ ë¶ˆí•„ìš”
   - ë§¤ì¼ êµ¬ì²´ì ì¸ í•™ìŠµ ê³¼ì œ ì œì‹œ

### ì‹œìŠ¤í…œ íš¨ìœ¨ì„±

1. **ìë™í™”ëœ ê³„íš ìƒì„±**
   - BKT + ì˜¤ë‹µë…¸íŠ¸ ê¸°ë°˜ ì•½ì  ìë™ íƒì§€
   - êµì‚¬ê°€ ìˆ˜ë™ìœ¼ë¡œ ê³„íš ì‘ì„±í•  í•„ìš” ì—†ìŒ

2. **AI ë¬¸ì œ ìƒì„±**
   - mathesis_core.generationìœ¼ë¡œ ë¬´í•œ ì˜ˆìƒ ë¬¸ì œ
   - í•™êµ ê¸°ì¶œ íŒ¨í„´ ë¶„ì„ (Node 6 í™œìš© ê°€ëŠ¥)

3. **ì‹¤ì‹œê°„ ì§„í–‰ ì¶”ì **
   - Redisë¡œ ì¼ì¼ ì§„í–‰ë¥  ìºì‹±
   - ë¶€ëª¨/êµì‚¬ ëŒ€ì‹œë³´ë“œì—ì„œ ëª¨ë‹ˆí„°ë§

4. **í™•ì¥ ê°€ëŠ¥í•œ ë¦¬í¬íŠ¸**
   - Typstë¡œ ë‹¤ì–‘í•œ ì‹œí—˜ í˜•ì‹ ì§€ì›
   - ìë™ ì±„ì  + ì·¨ì•½ì  ë¶„ì„ ë¦¬í¬íŠ¸

---

**Last Updated**: 2026-01-10
**Contributors**: Claude Sonnet 4.5
